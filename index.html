<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple SPC Tool (Run & XmR)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Annotation script -->
 <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
   <!-- PDF export script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script> 
  <! -- Excel export script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script>


  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 1.5rem;
      background-color: #f0f4f5; /* light NHS-style background */
      max-width: 100%;
    }
    h1 {
      margin-bottom: 0.25rem;
	color: #005eb8; /* NHS blue */
    }
    .sub {
      margin-top: 0;
      color: #555;
      font-size: 0.9rem;
    }
  .panel {
  padding: 1rem;
  border-radius: 0.5rem;
  border: 1px solid #d8dde0;
  background: #ffffff;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  margin-bottom: 1.5rem;
}
    label {
      display: inline-block;
      margin-right: 0.5rem;
      margin-top: 0.5rem;
    }
    select, input[type="file"], button {
      margin-top: 0.25rem;
      margin-bottom: 0.5rem;
    }
    /* Buttons */
button {
  padding: 0.45rem 0.9rem;
  border-radius: 9999px;
  border: 1px solid #005eb8;
  background: #005eb8;
  color: #ffffff;
  cursor: pointer;
  font-size: 0.9rem;
}

button:hover:not(:disabled) {
  background: #003f87;
  border-color: #003f87;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
    /* Make the main I/XmR chart tall and prominent */
.chart-container {
  width: 100%;
  height: 480px;          /* bigger, clearer */
  overflow: hidden;
}

/* MR chart a bit shorter */
#mrPanel .chart-container {
  height: 300px;
}
    .hint {
      font-size: 0.8rem;
      color: #666;
    }
    .error {
      color: #b00020;
      font-size: 0.9rem;
    }

.layout {
  display: flex;
  gap: 2rem;
  align-items: flex-start;
  max-width: 1400px;
  margin: 0 auto;
  padding: 0.5rem 0;
}

/* Sidebar with controls */
.sidebar {
  width: 320px;
  flex-shrink: 0;
  position: sticky;
  top: 1rem;
  font-size: 0.8rem;
}

.sidebar input,
.sidebar select,
.sidebar textarea {
  width: 100%;
  box-sizing: border-box;
  margin-bottom: 0.6rem;
}

/* Keep headings readable */
.sidebar .field-label {
  display: block;
  font-size: 0.9rem;
  margin: 0.4rem 0 0.2rem;
}

.radio-group {
  margin: 0.25rem 0 0.6rem 0;
}

.radio-inline {
  display: inline-flex;
  align-items: center;
  margin-right: 1rem;
  font-size: 0.9rem;
}

.radio-inline input[type="radio"] {
  margin-right: 0.35rem;
}

/* Compact radio group layout */
.radio-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  margin: 0 0.2rem 0 0;
}

/* Make each radio+label a small inline chip, not a big bar */
.radio-pill {
  display: inline-flex;
  align-items: center;
  border-radius: 9999px;
  border: none;
  background: transparent;
  cursor: pointer;
  white-space: nowrap;
  font-size: 0.8rem;
}

/* Override the generic sidebar label rule for these */
.sidebar .radio-pill {
  display: inline-flex;   /* cancels label { display:block } */
  width: auto;            /* no full-width bars */
}

/* Space between circle and text */
.radio-pill input[type="radio"] {
  margin-right: 0.25rem;
}

/* When the radio is checked, emphasise the pill */
.radio-pill input[type="radio"]:checked + span,
.radio-pill input[type="radio"]:checked {
  font-weight: 600;
  color: #005eb8;
}

/* Tiny hint text under each group */
.small-hint {
  font-size: 0.75rem;
  color: #666;
}

/* Main area with charts/summary */
.main {
  flex: 1;
  min-width: 0; /* prevents overflow */
}

/* Collapsible section styling */
.sidebar details {
  margin-bottom: 1rem;
}
.sidebar summary {
  font-weight: 600;
  cursor: pointer;
  padding: 0.25rem 0;
  color: #003087;
}
.sidebar summary::-webkit-details-marker {
  margin-right: 0.25rem;
}

.sidebar label {
  display: block;
  margin-bottom: 0.25rem;
}

.sidebar .radio-inline {
  display: inline-flex; /* override the block behaviour */
}

.sidebar input[type="text"],
.sidebar input[type="date"],
.sidebar input[type="number"],
.sidebar select {
  margin-bottom: 0.75rem;
}

canvas {
  display: block;
  max-width: 100%;
  max-height: 100%;
}

/* Generate button */
.sidebar-generate {
  margin-bottom: 0.5rem;
  border-radius: 9999px;
  border: 1px solid #005eb8;
  background: #03C04A;
  border-color: #03C04A;
  color: #ffffff;
  cursor: pointer;
}

.sidebar-generate:hover {
  background: #03AC13;
  border-color: #03AC13;
}


/* Toggle button */
.sidebar-toggle {
  margin-bottom: 0.5rem;
  padding: 0.35rem 0.9rem;
  border-radius: 9999px;
  border: 1px solid #005eb8;
  background: #BEBEBE;
  color: #ffffff;
  cursor: pointer;
  font-size: 0.85rem;
}

/* Slightly smaller than primary buttons so it feels like a utility */
.sidebar-toggle:hover {
  background: #A9A9A9;
  border-color: #A9A9A9;
}

/* When collapsed, slide the sidebar off to the left and let main fill space */
body.sidebar-collapsed .sidebar {
  transform: translateX(-110%);
  opacity: 0;
  pointer-events: none;
  position: absolute;
}

body.sidebar-collapsed .main {
  flex: 1 1 100%;
}

/* Smooth transition */
.sidebar {
  transition: transform 0.2s ease-out, opacity 0.2s ease-out;
}

/* Responsive: stack sidebar on top for narrow screens */
@media (max-width: 1000px) {
  .layout {
    flex-direction: column;
  }
  .sidebar {
    position: static;
    width: 100%;
  }
}

@media print {
  #exportButtons {
    display: none !important;
  }
}

/* Data editor modal */
#dataEditorOverlay {
  position: fixed;
  inset: 0;
  display: none;                /* toggled to flex in JS */
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.35);
  z-index: 1000;
}

.data-editor-dialog {
  background: #ffffff;
  max-width: 900px;
  width: 90%;
  max-height: 90vh;
  padding: 1rem;
  border-radius: 0.5rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
}

#dataEditorTextarea {
  width: 100%;
  flex: 1;
  min-height: 240px;
  resize: vertical;
  margin-top: 0.5rem;
  font-family: "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.85rem;
  padding: 0.5rem;
  border-radius: 0.25rem;
  border: 1px solid #d0d7de;
}

.data-editor-buttons {
  margin-top: 0.75rem;
  text-align: right;
}

.data-editor-buttons button {
  margin-left: 0.5rem;
}

/* SPC helper panel (bottom-right) */
#spcHelperPanel {
  position: fixed;
  right: 0.75rem;
  bottom: 0.75rem;
  width: 520px;

  /* key changes */
  max-height: 75vh;        /* taller, relative to viewport */
  height: auto;

  background: #ffffff;
  border-radius: 0.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  font-size: 0.8rem;

  display: flex;
  flex-direction: column; /* important */
  overflow: hidden;       /* prevent panel itself from scrolling */
  z-index: 900;
}


#spcHelperHeader {
  background: #005eb8;
  color: #ffffff;
  padding: 0.4rem 0.6rem;
  font-weight: 600;
}

#spcHelperHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Close (X) button */
#spcHelperCloseBtn {
  background: transparent;
  border: none;
  color: #ffffff;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  line-height: 1;
  padding: 0 0.25rem;
}

#spcHelperCloseBtn:hover {
  opacity: 0.85;
}


#spcHelperBody {
  padding: 0.5rem 0.6rem 0.6rem;
  display: flex;
  flex-direction: column;
  gap: 0.4rem;

  /* key */
  flex: 1 1 auto;
  min-height: 0; /* critical for scroll to work in flex layouts */
}


#spcHelperAnswer {
  font-size: 0.8rem;
  max-height: 32vh;
  overflow-y: auto;
}

#spcHelperIntro {
  font-size: 0.8rem;
  line-height: 1.25;
}

#spcHelperIntro ul {
  margin: 0.2rem 0 0 1rem;
  padding: 0;
}

.spc-helper-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 0.35rem;
  margin: 0.1rem 0 0.25rem;
}

.spc-helper-chips button {
  font-size: 0.75rem;
  padding: 0.2rem 0.45rem;
  border-radius: 9999px;
  border: 1px solid #d0d7de;
  background: #f6f8fa;
  cursor: pointer;
}

/* --- Fix chip styling so it overrides the global button styles --- */
#spcHelperPanel .spc-helper-chips button {
  /* override global button look */
  background: #f6f8fa;
  border: 1px solid #d0d7de;
  color: #003087;              /* <-- key fix: readable text */
  font-weight: 600;

  /* make long questions wrap nicely */
  white-space: normal;
  text-align: left;
  line-height: 1.2;
  max-width: 100%;

  /* keep them chip-like */
  padding: 0.3rem 0.55rem;
  border-radius: 9999px;
}

/* Hover/active states */
#spcHelperPanel .spc-helper-chips button:hover {
  background: #eef2f6;
}

#spcHelperPanel .spc-helper-chips button:active {
  transform: translateY(1px);
}


.spc-helper-chips button:hover {
  background: #eef2f6;
}

.spc-chip-section {
  margin-top: 0.15rem;
}

.spc-chip-title {
  font-size: 0.75rem;
  font-weight: 700;
  margin: 0.15rem 0 0.25rem;
  color: #2b2b2b;
}

/* Slightly tighten chips now that the panel is wider */
#spcHelperPanel .spc-helper-chips button {
  max-width: 100%;
}

/* Optional: visually show chart chips are “inactive” until a chart exists */
#spcHelperPanel .spc-helper-chips.is-disabled {
  opacity: 0.55;
  pointer-events: none;
}


#spcHelperOutput {
  font-size: 0.8rem;
  line-height: 1.3;

  /* scrolling behaviour */
  flex: 1 1 auto;     /* take remaining space */
  min-height: 4rem;
  overflow-y: auto;

  border: 1px solid #eef2f6;
  border-radius: 0.35rem;
  padding: 0.4rem 0.45rem;
  background: #ffffff;
}


#spcHelperOutput p {
  margin: 0.25rem 0;
}


#spcHelperControls {
  display: flex;
  gap: 0.25rem;
  margin-top: 0.25rem;
  flex-shrink: 0; /* never collapse */
}

#spcHelperOutput {
  scrollbar-width: thin;
}

#spcHelperOutput::-webkit-scrollbar {
  width: 6px;
}


#aiQuestionInput {
  flex: 1;
  padding: 0.25rem 0.4rem;
  border-radius: 0.25rem;
  border: 1px solid #d0d7de;
  font-size: 0.8rem;
}

#aiAskButton {
  padding: 0.25rem 0.6rem;
  font-size: 0.8rem;
}

/* Hide helper by default */
#spcHelperPanel {
  display: none; /* START HIDDEN */
  opacity: 0;
  transition: opacity 0.25s ease;
}

/* When visible */
#spcHelperPanel.visible {
  display: flex;
  opacity: 1;
}

/* Help button styling */
.helper-toggle-btn {
  width: 100%;
  padding: 0.4rem 0.6rem;
  margin-bottom: 0.5rem;
  background: #005eb8;
  color: white;
  border: none;
  border-radius: 0.35rem;
  font-size: 0.85rem;
  cursor: pointer;
}

.helper-toggle-btn:hover {
  background: #003f78;
}

  </style>
</head>

<body>
  <h1>Simple SPC Web Tool</h1>
  <p class="sub">Upload data and create SPC charts in your browser. Data never leaves your browser.</p>

<div class="panel" id="exportButtons" style="margin-top:0.5rem;">
<button id="toggleSidebarButton" class="sidebar-toggle" style="margin-left:0.5rem;"> Hide controls</button>
<button id="generateButton" class="sidebar-generate" style="margin-left:0.5rem;">Generate chart</button> 
<button id="resetButton" type="button" style="margin-left:0.5rem;">Reset tool</button>
<button id="downloadPngButton" style="margin-left:0.5rem;">Download chart as PNG</button>
<button id="downloadPdfButton" style="margin-left:0.5rem;">Download PDF report</button>
<button type="button" style="margin-left:0.5rem;" onclick="toggleHelpSection()">Help &amp; guidance</button>
<button type="button" style="margin-left:0.5rem;" onclick="toggleSpcHelper()">SPC helper</button>

<div id="errorMessage" class="error"></div>
</div>

<p class="sub">Add your data, select your requirements, click 'Generate chart' to create, or re-draw your charts after changing settings. Not sure about SPC? Ask the helper.</p>

<div class="layout">
    <!-- SIDEBAR: all controls -->
    <aside class="sidebar">

<!-- Section 1: Data upload & columns -->
      <details open>
        <summary>1. Data & columns</summary>
	<div class="panel">

    <div>
      <label for="fileInput"><strong>1. Add data:</strong></label><br />
	<div class="hint">
        Upload a csv file or use the data editor to paste/type/edit data directly.
      	</div>      
	<input type="file" id="fileInput" accept=".csv" />
      <div class="hint">
        Expected columns: a date/time column (e.g. <code>Date</code>) and a numeric column (e.g. <code>Value</code>).
      </div>
	<button id="openDataEditorButton" type="button" style="margin-top:0.5rem;">
 	 Open data editor (paste/type data)
	</button>
    </div>

    <div id="columnSelectors" style="display: none;">
      <hr />
      <strong>Choose columns:</strong><br />

      <label>Date / X-axis column:
        <select id="dateColumn"></select>
      </label>

      <label>Value / Y-axis column:
        <select id="valueColumn"></select>
      </label>
	<hr />
	<strong class="field-label">X-axis type:</strong>
	<div class="radio-row">
 	 <label class="radio-pill">
  	  <input type="radio" name="axisType" value="date" checked />
   	 Date / time (sort by date)
 	 </label>
  	<label class="radio-pill">
    	<input type="radio" name="axisType" value="sequence" />
    	Sequence / category (row order)
  	</label>
	</div>
	<div class="hint small-hint">
  	Use <em>Date / time</em> for time-series SPC (e.g. daily averages),
  	or <em>Sequence / category</em> to plot each row in the order it appears
  	(e.g. individual patients).
	</div>
	<hr />
      	<strong class="field-label">Chart type:</strong>
	<div class="radio-row">
  	<label class="radio-pill">
    	<input type="radio" name="chartType" value="run" checked />
    	Run chart
  	</label>
  	<label class="radio-pill">
    	<input type="radio" name="chartType" value="xmr" />
    	XmR chart
  	</label>
	</div>
	<div class="hint small-hint">
  	Run chart uses the median only. XmR chart adds mean, control limits and sigma lines.
	</div>
	<div class="radio-row">
  	<label class="radio-pill">
    	<input type="checkbox" id="showMRCheckbox" checked>
    	Show Moving Range (MR) chart
  	</label>
	</div>

      	</details>


	<!-- Section 2: Titles & labels -->
        <details>
        <summary>2. Titles & labels</summary>
        <div class="panel">
	<div>
  	<label>
    	Chart title:
    	<input type="text" id="chartTitle" placeholder="e.g. X-MR Chart – Demonstration data" style="width: 16rem;" />
  	</label>
	</div>
	<div>
  	<label>
    	X-axis label:
   	 <input type="text" id="xAxisLabel" placeholder="Date" style="width: 16rem;" />
 	 </label>
	</div>
	<div>
  	<label>
   	 Y-axis label:
    	<input type="text" id="yAxisLabel" placeholder="Example metric" style="width: 16rem;" />
 	 </label>
	</div>
	</div>
      </details>

	<!-- Section 3: Target & capability -->
      <details>
        <summary>3. Target & capability</summary>
        <div class="panel">
	<div>
	  <label>
	    Target / goal value:
	    <input type="number" id="targetValue" step="any" placeholder="e.g. 30" style="width: 10rem;" />
	  </label>
	  <div class="hint">
	    If set, a dashed orange target line will be drawn across the chart.
	  </div>
	</div>
	<div>
	  <label>
	    Target direction:
	    <select id="targetDirection">
	      <option value="above">At or above target is good</option>
	      <option value="below">At or below target is good</option>
	    </select>
	  </label>
	</div>
 	</div>
      </details>

	<!-- Section 4: Annotations -->
      	<details>
        <summary>4. Annotations</summary>
        <div class="panel">
	<div>
  	<label>
   	 Annotation marker:
    	<select id="annotationDate">
    	  <!-- options will be filled automatically from the chart dates -->
   	 </select>
 	 </label>
	</div>
	<div>
 	 <label>
   	 Annotation label:
  	  <input type="text" id="annotationLabel" placeholder="e.g. New pathway introduced" style="width: 16rem;" />
 	 </label>
	</div>
	<button id="addAnnotationButton" type="button">Add annotation</button>
	<button id="clearAnnotationsButton" type="button">
	 Clear all annotations
	</button>
	<div class="hint">
  	Annotations will appear as vertical dashed lines with labels on the chart.
	</div>
	 </div>
      </details>

      <!-- Section 5: Baseline & splits -->
      <details>
        <summary>5. Baseline & split</summary>
        <div class="panel">
	<label>
      Use first
      <input type="number" id="baselinePoints" min="2" step="1" style="width: 4rem;" />
      points as baseline 
     </label>
     <div class="hint">
      Baseline restricts points used to calculate centre line and limits. Leave blank to use <em>all</em> points to calculate the median/mean and limits.
     </div>
      <hr>
	<strong>Split the XmR chart:</strong>
	<div class="hint">
      Splitting the control limits should <em>only</em> be done where a sustained shift in performance has been investigated, understood and agreed to be representative of the <em>new normal</em> level of performance for the process.
     </div>
	<label>
  	Add split after:
  	<select id="splitPointSelect"></select>
	</label>

	<button id="addSplitButton" type="button">Add split</button>
	<button id="clearSplitsButton" type="button" style="margin-left: 0.5rem;">
  	Clear splits
	</button>

	<div class="hint">
  	Splits allow the centre line and limits to recalculate from a chosen point onward (XmR only).
	</div>
        </div>
      	</details>



    </aside>

<!-- MAIN AREA: charts + analysis -->
    <main class="main">
      <div id="reportContent">  

        <div class="panel">
          <strong>Chart:</strong>
          <div class="chart-container">
            <canvas id="spcChart"></canvas>
          </div>
          
          <div id="summary" style="margin-top: 1rem; font-size: 0.9rem;"></div>
          <div id="capability" style="margin-top: 1rem; font-size: 0.9rem;"></div>
        </div>

        <div class="panel" id="mrPanel" style="display: none;">
          <strong>Moving Range chart:</strong>
          <div class="chart-container">
            <canvas id="mrChartCanvas"></canvas>
          </div>
        </div>

      </div> <!-- end #reportContent -->
	
    </main>

  </div> <!-- end .layout -->

  <!-- HELP SECTION -->
  <section id="helpSection" class="panel" style="display:none;">
    <h2>Help &amp; guidance</h2>
    <p class="sub">
      This section explains how to use the Simple SPC Web Tool and how to interpret the charts.
    </p>

    <details open>
      <summary><strong>1. What this tool does</strong></summary>
      <p>
        This tool creates simple Statistical Process Control (SPC) charts directly in your browser.
        It supports:
      </p>
      <ul>
        <li><strong>Run charts</strong> – values over time with a median line and simple run/trend rules.</li>
        <li><strong>XmR charts</strong> – Individuals (X) chart with mean and control limits plus a Moving Range (MR) chart.</li>
      </ul>
      <p>
        All calculations happen in your browser. The data are <strong>not</strong> uploaded to a server.
      </p>
    </details>

    <details>
      <summary><strong>2. Preparing and loading your data</strong></summary>
      <ul>
        <li>Your data should have at least two columns:
          <ul>
            <li>a <strong>time/order column</strong> (e.g. date, month, or sequence number), and</li>
            <li>a <strong>numeric column</strong> (e.g. waiting time, rate, count, score).</li>
          </ul>
        </li>
        <li>Click <strong>“Upload CSV file”</strong> to choose a .csv file, or use the
          <strong>“Open data editor (paste/type data)”</strong> button to paste directly from Excel.</li>
        <li>Once loaded, use the <strong>“Choose columns”</strong> dropdowns to specify:
          <ul>
            <li><strong>Date / X-axis column</strong></li>
            <li><strong>Value / Y-axis column</strong></li>
          </ul>
        </li>
      </ul>
      <p class="hint">
        If the chart does not appear, check that the value column contains valid numbers and that there are no
        unexpected headers or blank rows in the middle of the data.
      </p>
    </details>

    <details>
      <summary><strong>3. X-axis type &amp; chart type</strong></summary>
      <h3 style="margin-top:0.4rem;">X-axis type</h3>
      <ul>
        <li><strong>Date / time</strong> – recommended for usual time-series SPC (e.g. daily or weekly metrics).
        </li>
        <li><strong>Sequence / category</strong> – use when you want each row in the order it appears, e.g. individual
          patients, tests or cases, even if the X-value is not a date.</li>
      </ul>

      <h3 style="margin-top:0.8rem;">Chart type</h3>
      <ul>
        <li><strong>Run chart</strong>
          <ul>
            <li>Draws a median line only.</li>
            <li>Highlights long runs and trends as possible special-cause signals.</li>
          </ul>
        </li>
        <li><strong>XmR chart</strong>
          <ul>
            <li>Draws a mean with upper and lower control limits (UCL/LCL).</li>
            <li>Shows ±1σ and ±2σ reference lines where possible.</li>
            <li>Includes an optional <strong>Moving Range (MR)</strong> chart underneath.</li>
          </ul>
        </li>
      </ul>
    </details>

    <details>
      <summary><strong>4. Baseline, splits and target</strong></summary>
      <h3 style="margin-top:0.4rem;">Baseline</h3>
      <p>
        The <strong>“Use first N points as baseline”</strong> box lets you restrict which points are used to calculate
        the median (run chart) or mean and limits (XmR).
        Leave this blank to use all points.
      </p>

      <h3 style="margin-top:0.8rem;">Splits (XmR only)</h3>
      <p>
        The <strong>“Split the XmR chart”</strong> controls allow you to recalculate the mean and limits from a chosen
        point onwards. This is useful when you make a clear change to the system (e.g. a new pathway) and want to see
        the new, post-change process performance.
      </p>

      <h3 style="margin-top:0.8rem;">Target / goal</h3>
      <p>
        You can enter a <strong>Target / goal value</strong> and choose whether “at or above” or “at or below” the
        target is desirable. The chart will show a dashed target line.
      </p>
      <p class="hint">
        In XmR mode, the summary panel will show an approximate process capability against this target
        <em>if</em> the process looks stable (no obvious special-cause signals).
      </p>
    </details>

    <details>
      <summary><strong>5. Annotations</strong></summary>
      <p>
        Use the <strong>Annotations</strong> section to mark important events, such as new interventions, policy changes
        or data definition changes.
      </p>
      <ul>
        <li>Select an <strong>Annotation date</strong> from the dropdown (this uses the dates on the X-axis).</li>
        <li>Type a short <strong>Annotation label</strong> (e.g. “New pathway introduced”).</li>
        <li>Click <strong>“Add annotation”</strong> to add a vertical dashed line and label.</li>
        <li>Use <strong>“Clear all annotations”</strong> to remove them.</li>
      </ul>
    </details>

    <details>
      <summary><strong>6. Interpreting the summary</strong></summary>
      <p>
        Under the chart, the <strong>Summary</strong> section gives a brief interpretation of the pattern.
        It comments on:
      </p>
      <ul>
        <li>Number of data points and which points are used as baseline.</li>
        <li>The median (run chart) or mean and limits (XmR).</li>
        <li>Whether any simple rules are breached (points beyond limits, long runs, or clear trends).</li>
      </ul>
      <p class="hint">
        These rules are intended as prompts, not absolute answers.
        Always interpret the pattern in the context of the clinical or operational system.
      </p>
    </details>

    <details>
      <summary><strong>7. Downloading charts and reports</strong></summary>
      <ul>
        <li><strong>Download chart as PNG</strong> – saves the main chart as an image for use in slides, emails or reports.</li>
        <li><strong>Download PDF report</strong> – exports the chart and summary into a simple PDF layout.</li>
      </ul>
      <p class="hint">
        Check the PDF in a PDF viewer before sharing, especially if your chart is very wide or contains many annotations.
      </p>
    </details>

    <details>
      <summary><strong>8. Data privacy</strong></summary>
      <p>
        The tool runs entirely in your browser:
      </p>
      <ul>
        <li>Data are not sent to a server.</li>
        <li>Once you close the page, your data are no longer available to the tool.</li>
      </ul>
      <p class="hint">
        Always follow your local information governance guidance before using real patient-identifiable data.
      </p>
    </details>

	<details>
      <summary><strong>9. About the tool</strong></summary>
      <p>
        This tool was developed by Jem Ramazanoglu - <a href="mailto:j.ramazanoglu@nhs.net">j.ramazanoglu@nhs.net</a> as a free resource to support Quality 	Improvement in the NHS.</p>
      <p class="hint">
        I hope you like the tool - I'm always keen to hear feedback - please let me know if you spot a bug or to suggest an improvement.
      </p>
    </details>

  </section>


<div id="dataEditorOverlay">
  <div class="data-editor-dialog">
    <h2>Data editor</h2>
    <p class="hint">
      Paste data from Excel or type it directly. The first row can be headers (e.g. <code>Date,Value</code>).
      When you click <strong>Apply data</strong>, the chart options will update to use this data.
    </p>
    <textarea id="dataEditorTextarea" spellcheck="false"></textarea>
    <div class="data-editor-buttons">
      <button id="dataEditorApplyButton" type="button">Apply data</button>
      <button id="dataEditorCancelButton" type="button">Cancel</button>
    </div>
  </div>
</div>

<!-- SPC Helper (rule-based "AI") -->
<div id="spcHelperPanel">
  <div id="spcHelperHeader">
  <span>SPC helper</span>
  <button
    type="button"
    id="spcHelperCloseBtn"
    aria-label="Close SPC helper"
    title="Close"
  >
    ×
  </button>
</div>
  <div id="spcHelperBody">
  <div id="spcHelperIntro"></div>

  <div class="spc-chip-section">
  <div class="spc-chip-title">General SPC questions</div>
  <div id="spcHelperChipsGeneral" class="spc-helper-chips" aria-label="General SPC suggested questions"></div>
</div>

<div class="spc-chip-section">
  <div class="spc-chip-title">My chart questions</div>
  <div id="spcHelperChipsChart" class="spc-helper-chips" aria-label="My chart suggested questions"></div>
</div>


  <div id="spcHelperOutput" aria-live="polite"></div>

  <div id="spcHelperControls">
    <input id="aiQuestionInput" type="text" placeholder="Ask a question…" />
    <button id="aiAskButton" type="button">Ask</button>
  </div>
</div>
</div>


  <script src="spc.js"></script>
</body>
</html>