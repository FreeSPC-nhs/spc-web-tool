<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple SPC Tool (Run & XmR)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Annotation script -->
 <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
   <!-- PDF export script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script> 

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 1.5rem;
      max-width: 900px;
    }
    h1 {
      margin-bottom: 0.25rem;
    }
    .sub {
      margin-top: 0;
      color: #555;
      font-size: 0.9rem;
    }
    .panel {
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #ddd;
      margin-bottom: 1rem;
    }
    label {
      display: inline-block;
      margin-right: 0.5rem;
      margin-top: 0.5rem;
    }
    select, input[type="file"], button {
      margin-top: 0.25rem;
      margin-bottom: 0.5rem;
    }
    button {
      padding: 0.4rem 0.8rem;
      border-radius: 0.4rem;
      border: 1px solid #0078d4;
      background: #0078d4;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .chart-container {
      margin-top: 1rem;
      height: 400px;
    }
    .hint {
      font-size: 0.8rem;
      color: #666;
    }
    .error {
      color: #b00020;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>Simple SPC Web Tool</h1>
  <p class="sub">Upload a CSV, pick your columns, and draw a Run chart or XmR chart in the browser.</p>

  <div class="panel">
    <div>
      <label for="fileInput"><strong>1. Upload CSV file:</strong></label><br />
      <input type="file" id="fileInput" accept=".csv" />
      <div class="hint">
        Expected columns: a date/time column (e.g. <code>Date</code>) and a numeric column (e.g. <code>Value</code>).
      </div>
    </div>

    <div id="columnSelectors" style="display: none;">
      <hr />
      <strong>2. Choose columns:</strong><br />

      <label>Date column:
        <select id="dateColumn"></select>
      </label>

      <label>Value column:
        <select id="valueColumn"></select>
      </label>

      <br />
      <strong>3. Chart type:</strong><br />
      <label>
        <input type="radio" name="chartType" value="run" checked />
        Run chart (median only)
      </label>
      <label>
        <input type="radio" name="chartType" value="xmr" />
        XmR chart (mean + control limits)
      </label>

      <br /><br />

	<strong>4. Titles / labels (optional):</strong><br />
	<div>
  	<label>
    	Chart title:
    	<input type="text" id="chartTitle" placeholder="e.g. I-MR Chart â€“ Demonstration data" style="width: 24rem;" />
  	</label>
	</div>
	<div>
  	<label>
    	X-axis label:
   	 <input type="text" id="xAxisLabel" placeholder="Date" style="width: 16rem;" />
 	 </label>
	</div>
	<div>
  	<label>
   	 Y-axis label:
    	<input type="text" id="yAxisLabel" placeholder="Example metric" style="width: 16rem;" />
 	 </label>
	</div>
	<div>
	  <label>
	    Target / goal value:
	    <input type="number" id="targetValue" step="any" placeholder="e.g. 30" style="width: 10rem;" />
	  </label>
	  <div class="hint">
	    If set, a dashed orange target line will be drawn across the chart.
	  </div>
	</div>
	<div>
	  <label>
	    Target direction:
	    <select id="targetDirection">
	      <option value="above">At or above target is good</option>
	      <option value="below">At or below target is good</option>
	    </select>
	  </label>
	</div>

<br />
<strong>5. Annotations (optional):</strong><br />
<div>
  <label>
    Annotation date:
    <input type="date" id="annotationDate" />
  </label>
</div>
<div>
  <label>
    Annotation label:
    <input type="text" id="annotationLabel" placeholder="e.g. New pathway introduced" style="width: 24rem;" />
  </label>
</div>
<button id="addAnnotationButton" type="button">Add annotation</button>
<div class="hint">
  Annotations will appear as vertical dashed lines with labels on the chart.
</div>

	<br />

      <strong>6. Baseline (optional):</strong><br />
      <label>
      Use first
      <input type="number" id="baselinePoints" min="2" step="1" style="width: 4rem;" />
      points as baseline for centre line and limits
     </label>
     <div class="hint">
      Leave blank to use <em>all</em> points to calculate the median/mean and limits.
     </div>

  <br />	
      <button id="generateButton">Generate chart</button>
      <span class="hint">Data never leaves your browser.</span>
      <div id="errorMessage" class="error"></div>
    </div>
  </div>

<div id="reportContent">  
<div class="panel">
  <strong>7. Chart:</strong>
  <div class="chart-container">
    <canvas id="spcChart"></canvas>
  </div>

  <div class="panel" id="mrPanel" style="display: none;">
  <strong>Moving Range chart:</strong>
  <div class="chart-container">
    <canvas id="mrChartCanvas"></canvas>
  </div>
  </div>

  <button id="downloadPngButton" style="margin-top: 0.5rem;">
  Download chart as PNG
</button>

<button id="downloadPdfButton" style="margin-top: 0.5rem; margin-left: 0.5rem;">
  Download PDF report
</button>

  <div id="summary" style="margin-top: 1rem; font-size: 0.9rem;"></div>

  <div id="capability" style="margin-top: 1rem; font-size: 0.9rem;"></div>
</div>
</div>
   <script src="spc.js"></script>
</body>
</html>
